<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>FAST-ER: learn_fast_tree.cc File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>learn_fast_tree.cc File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Main file for the <code>learn_fast_tree</code> executable. 
<p>
<code> learn_fast_tree [--weight.</code><em>x weight</em><code> ] ... &lt; </code> <em>infile</em> <code>&gt;</code> <em>outfile</em> <p>
<code>learn_fast_tree</code> used ID3 to learn a ternary decision <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a> for corner detection. The data is read from the standard input, and the <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a> is written to the standard output. This is designed to learn FAST feature detectors, and does not allow for the possibility ambbiguity in the input data.<h2><a class="anchor" name="lfInput">
Input data</a></h2>
The input data has the following format:<p>
<div class="fragment"><pre class="fragment">

5
[-1 -1] [1 1] [3 4] [5 6] [-3 4]
bbbbb 1     0
bsdsb 1000  1
.
.
.
</pre></div><p>
The first row is the number of features. The second row is the the list of offsets assosciated with each feature. This list has no effect on the learning of the <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a>, but it is passed through to the outpur for convinience.<p>
The remaining rows contain the data. The first field is the ternary feature vector. The three characters "b", "d" and "s" are the correspond to brighter, darker and similar respectively, with the first feature being stored in the first character and so on.<p>
The next field is the number of instances of the particular feature. The third field is the class, with 1 for corner, and 0 for background.<h3><a class="anchor" name="f9Generate">
Generating input data</a></h3>
Ideally, input data will be generated from some sample images. The program FIXME can be used to do this.<p>
Additionally, a the program fast_N_features can be used to generate all possible feature combinations for FAST-N features. When run without arguments, it generates data for FAST-9 features, otherwise the argument can be used to specify N.<h2><a class="anchor" name="lfGen">
Output data</a></h2>
The program does not generate source code directly, rather it generates an easily parsabel representation of a decision <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a> which can be turned in to source code.<p>
The structure of the <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a> is described in detail in <a class="el" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>. 
<p>Definition in file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>

<p>

<p>
<a href="learn__fast__tree_8cc-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdatapoint.html">datapoint&lt; FEATURE_SIZE &gt;</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This structure represents a <a class="el" href="structdatapoint.html" title="This structure represents a datapoint.">datapoint</a>.  <a href="structdatapoint.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtree.html">tree</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This class represents a decision <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a>.  <a href="structtree.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__gUtility.html#g9a3d9e758aa01b90e2067121300f17d2">fatal</a>(E, S,...)&nbsp;&nbsp;&nbsp;vfatal((E), (S), (tag::Fmt,## __VA_ARGS__))</td></tr>

<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd">Ternary</a> { <a class="el" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd921c8fbda165a3c2613fe9e6d75102d0">Brighter</a> = 'b', 
<a class="el" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd419a3322847cb783c0050a64a1df8743">Darker</a> = 'd', 
<a class="el" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcdbf5e6bccdc838bc194a062b340d0d1fc">Similar</a> = 's'
 }</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memTemplParams" nowrap colspan="2">template&lt;class C&gt; </td></tr>
<tr><td class="memTemplItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__gUtility.html#g4a38fb954301d16e2b9da85d1ffc1543">vfatal</a> (int err, const string &amp;s, const C &amp;list)</td></tr>

<tr><td class="memTemplParams" nowrap colspan="2">template&lt;int S&gt; </td></tr>
<tr><td class="memTemplItemLeft" nowrap align="right" valign="top">V_tuple&lt; shared_ptr<br>
&lt; vector&lt; <a class="el" href="structdatapoint.html">datapoint</a><br>
&lt; S &gt; &gt; &gt;, uint64_t &gt;<br>
::type&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#157228e398bf6b3e094f87e36915e742">load_features</a> (unsigned int nfeats)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#9f5a3512e4c78a92da4ba7aaaaaf095f">entropy</a> (uint64_t n, uint64_t c1)</td></tr>

<tr><td class="memTemplParams" nowrap colspan="2">template&lt;int S&gt; </td></tr>
<tr><td class="memTemplItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#ce3ca018f064f7d82baab3d67529ab5d">find_best_split</a> (const vector&lt; <a class="el" href="structdatapoint.html">datapoint</a>&lt; S &gt; &gt; &amp;fs, const vector&lt; double &gt; &amp;weights, unsigned int nfeats)</td></tr>

<tr><td class="memTemplParams" nowrap colspan="2">template&lt;int S&gt; </td></tr>
<tr><td class="memTemplItemLeft" nowrap align="right" valign="top">shared_ptr&lt; <a class="el" href="structtree.html">tree</a> &gt;&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#cdf532026168bb78545e9111afa2f008">build_tree</a> (vector&lt; <a class="el" href="structdatapoint.html">datapoint</a>&lt; S &gt; &gt; &amp;corners, const vector&lt; double &gt; &amp;weights, int nfeats)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a">print_tree</a> (const <a class="el" href="structtree.html">tree</a> *node, ostream &amp;o, const string &amp;i=&quot;&quot;)</td></tr>

<tr><td class="memTemplParams" nowrap colspan="2">template&lt;int S&gt; </td></tr>
<tr><td class="memTemplItemLeft" nowrap align="right" valign="top">V_tuple&lt; shared_ptr<br>
&lt; <a class="el" href="structtree.html">tree</a> &gt;, uint64_t &gt;<br>
::type&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#7c577f5c2749b97093f09f57637f48fb">load_and_build_tree</a> (unsigned int num_features, const vector&lt; double &gt; &amp;weights)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="learn__fast__tree_8cc.html#3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>

</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="5475d259eeee26da1b2bcffcc581ebcd"></a><!-- doxytag: member="learn_fast_tree.cc::Ternary" ref="5475d259eeee26da1b2bcffcc581ebcd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd">Ternary</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Representations of ternary digits. 
<p>
<dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="5475d259eeee26da1b2bcffcc581ebcd921c8fbda165a3c2613fe9e6d75102d0"></a><!-- doxytag: member="Brighter" ref="5475d259eeee26da1b2bcffcc581ebcd921c8fbda165a3c2613fe9e6d75102d0" args="" -->Brighter</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="5475d259eeee26da1b2bcffcc581ebcd419a3322847cb783c0050a64a1df8743"></a><!-- doxytag: member="Darker" ref="5475d259eeee26da1b2bcffcc581ebcd419a3322847cb783c0050a64a1df8743" args="" -->Darker</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="5475d259eeee26da1b2bcffcc581ebcdbf5e6bccdc838bc194a062b340d0d1fc"></a><!-- doxytag: member="Similar" ref="5475d259eeee26da1b2bcffcc581ebcdbf5e6bccdc838bc194a062b340d0d1fc" args="" -->Similar</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00114">114</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116     <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd921c8fbda165a3c2613fe9e6d75102d0">Brighter</a>=<span class="charliteral">'b'</span>,
<a name="l00117"></a>00117     <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd419a3322847cb783c0050a64a1df8743">Darker</a>  =<span class="charliteral">'d'</span>,
<a name="l00118"></a>00118     <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcdbf5e6bccdc838bc194a062b340d0d1fc">Similar</a> =<span class="charliteral">'s'</span>
<a name="l00119"></a>00119 };
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="157228e398bf6b3e094f87e36915e742"></a><!-- doxytag: member="learn_fast_tree.cc::load_features" ref="157228e398bf6b3e094f87e36915e742" args="(unsigned int nfeats)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;int S&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">V_tuple&lt;shared_ptr&lt;vector&lt;<a class="el" href="structdatapoint.html">datapoint</a>&lt;S&gt; &gt; &gt;, uint64_t &gt;::type load_features           </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>nfeats</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function loads as many datapoints from the standard input as possible. 
<p>
Datapoints consist of a feature vector (a string containing the characters "b", "d" and "s"), a number of instances and a class.<p>
See <a class="el" href="structdatapoint.html#020ec35c899ccbceb21c67ccde510b7c" title="This code reads a stringified representation of the feature vector and converts it...">datapoint::pack_trits</a> for a more complete description of the feature vector.<p>
The tokens are whitespace separated.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nfeats</em>&nbsp;</td><td>Number of features in a feature vector. Used to spot errors. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Loaded datapoints and total number of instances. </dd></dl>

<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00246">246</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>

<p>References <a class="el" href="learn__fast__tree_8cc-source.html#l00125">fatal</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00247"></a>00247 {
<a name="l00248"></a>00248     shared_ptr&lt;vector&lt;datapoint&lt;S&gt; &gt; &gt; ret(<span class="keyword">new</span> vector&lt;<a class="code" href="structdatapoint.html" title="This structure represents a datapoint.">datapoint&lt;S&gt;</a> &gt;);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="keywordtype">string</span> unpacked_feature;
<a name="l00252"></a>00252     
<a name="l00253"></a>00253     uint64_t total_num = 0;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     uint64_t line_num=2;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">for</span>(;;)
<a name="l00258"></a>00258     {
<a name="l00259"></a>00259         uint64_t count;
<a name="l00260"></a>00260         <span class="keywordtype">bool</span> is;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         cin &gt;&gt; unpacked_feature &gt;&gt; count &gt;&gt; is;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <span class="keywordflow">if</span>(!cin)
<a name="l00265"></a>00265             <span class="keywordflow">break</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         line_num++;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="keywordflow">if</span>(unpacked_feature.size() != nfeats)
<a name="l00270"></a>00270             <a class="code" href="group__gUtility.html#g9a3d9e758aa01b90e2067121300f17d2" title="Print an error message and the exit.">fatal</a>(1, <span class="stringliteral">"Feature string length is %i, not %i on line %i"</span>, unpacked_feature.size(), nfeats, line_num);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="keywordflow">if</span>(count == 0)
<a name="l00273"></a>00273             <a class="code" href="group__gUtility.html#g9a3d9e758aa01b90e2067121300f17d2" title="Print an error message and the exit.">fatal</a>(4, <span class="stringliteral">"Zero count is invalid"</span>);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         ret-&gt;push_back(<a class="code" href="structdatapoint.html" title="This structure represents a datapoint.">datapoint&lt;S&gt;</a>(unpacked_feature, count, is));
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         total_num += count;
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     cerr &lt;&lt; <span class="stringliteral">"Num features: "</span> &lt;&lt; total_num &lt;&lt; endl
<a name="l00281"></a>00281          &lt;&lt; <span class="stringliteral">"Num distinct: "</span> &lt;&lt; ret-&gt;size() &lt;&lt; endl;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="keywordflow">return</span> make_vtuple(ret, total_num);
<a name="l00284"></a>00284 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9f5a3512e4c78a92da4ba7aaaaaf095f"></a><!-- doxytag: member="learn_fast_tree.cc::entropy" ref="9f5a3512e4c78a92da4ba7aaaaaf095f" args="(uint64_t n, uint64_t c1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double entropy           </td>
          <td>(</td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>c1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Compute the entropy of a set with binary annotations. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>n</em>&nbsp;</td><td>Number of elements in the set </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c1</em>&nbsp;</td><td>Number of elements in class 1 </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The set entropy. </dd></dl>

<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00291">291</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>

<p>Referenced by <a class="el" href="learn__fast__tree_8cc-source.html#l00313">find_best_split()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00292"></a>00292 {
<a name="l00293"></a>00293     assert(c1 &lt;= n);
<a name="l00294"></a>00294     <span class="comment">//n is total number, c1 in num in class 1</span>
<a name="l00295"></a>00295     <span class="keywordflow">if</span>(n == 0)
<a name="l00296"></a>00296         <span class="keywordflow">return</span> 0;
<a name="l00297"></a>00297     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(c1 == 0 || c1 == n)
<a name="l00298"></a>00298         <span class="keywordflow">return</span> 0;
<a name="l00299"></a>00299     <span class="keywordflow">else</span>
<a name="l00300"></a>00300     {
<a name="l00301"></a>00301         <span class="keywordtype">double</span> p1 = (double)c1 / n;
<a name="l00302"></a>00302         <span class="keywordtype">double</span> p2 = 1-p1;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="keywordflow">return</span> -(double)n*(p1*log(p1) + p2*log(p2)) / log(2.f);
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ce3ca018f064f7d82baab3d67529ab5d"></a><!-- doxytag: member="learn_fast_tree.cc::find_best_split" ref="ce3ca018f064f7d82baab3d67529ab5d" args="(const vector&lt; datapoint&lt; S &gt; &gt; &amp;fs, const vector&lt; double &gt; &amp;weights, unsigned int nfeats)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;int S&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">int find_best_split           </td>
          <td>(</td>
          <td class="paramtype">const vector&lt; <a class="el" href="structdatapoint.html">datapoint</a>&lt; S &gt; &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const vector&lt; double &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>nfeats</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Find the feature that has the highest weighted entropy change. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>datapoints to split in to three subsets. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>weights</em>&nbsp;</td><td>weights on features </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nfeats</em>&nbsp;</td><td>Number of features in use. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>best feature. </dd></dl>

<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00313">313</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>

<p>References <a class="el" href="learn__fast__tree_8cc-source.html#l00116">Brighter</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00117">Darker</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00291">entropy()</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00125">fatal</a>, and <a class="el" href="learn__fast__tree_8cc-source.html#l00118">Similar</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00314"></a>00314 {
<a name="l00315"></a>00315     assert(nfeats == weights.size());
<a name="l00316"></a>00316     uint64_t num_total = 0, num_corners=0;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="keywordflow">for</span>(<span class="keyword">typename</span> vector&lt;<a class="code" href="structdatapoint.html" title="This structure represents a datapoint.">datapoint&lt;S&gt;</a> &gt;::const_iterator i=fs.begin(); i != fs.end(); i++)
<a name="l00319"></a>00319     {
<a name="l00320"></a>00320         num_total += i-&gt;count;
<a name="l00321"></a>00321         <span class="keywordflow">if</span>(i-&gt;is_a_corner)
<a name="l00322"></a>00322             num_corners += i-&gt;count;
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordtype">double</span> total_entropy = <a class="code" href="learn__fast__tree_8cc.html#9f5a3512e4c78a92da4ba7aaaaaf095f" title="Compute the entropy of a set with binary annotations.">entropy</a>(num_total, num_corners);
<a name="l00326"></a>00326     
<a name="l00327"></a>00327     <span class="keywordtype">double</span> biggest_delta = 0;
<a name="l00328"></a>00328     <span class="keywordtype">int</span>   feature_num = -1;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; nfeats; i++)
<a name="l00331"></a>00331     {
<a name="l00332"></a>00332         uint64_t num_bri = 0, num_dar = 0, num_sim = 0;
<a name="l00333"></a>00333         uint64_t cor_bri = 0, cor_dar = 0, cor_sim = 0;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="keywordflow">for</span>(<span class="keyword">typename</span> vector&lt;<a class="code" href="structdatapoint.html" title="This structure represents a datapoint.">datapoint&lt;S&gt;</a> &gt;::const_iterator f=fs.begin(); f != fs.end(); f++)
<a name="l00336"></a>00336         {
<a name="l00337"></a>00337             <span class="keywordflow">switch</span>(f-&gt;get_trit(i))
<a name="l00338"></a>00338             {
<a name="l00339"></a>00339                 <span class="keywordflow">case</span> <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd921c8fbda165a3c2613fe9e6d75102d0">Brighter</a>:
<a name="l00340"></a>00340                     num_bri += f-&gt;count;
<a name="l00341"></a>00341                     <span class="keywordflow">if</span>(f-&gt;is_a_corner)
<a name="l00342"></a>00342                         cor_bri += f-&gt;count;
<a name="l00343"></a>00343                     <span class="keywordflow">break</span>;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345                 <span class="keywordflow">case</span> <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd419a3322847cb783c0050a64a1df8743">Darker</a>:
<a name="l00346"></a>00346                     num_dar += f-&gt;count;
<a name="l00347"></a>00347                     <span class="keywordflow">if</span>(f-&gt;is_a_corner)
<a name="l00348"></a>00348                         cor_dar += f-&gt;count;
<a name="l00349"></a>00349                     <span class="keywordflow">break</span>;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351                 <span class="keywordflow">case</span> <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcdbf5e6bccdc838bc194a062b340d0d1fc">Similar</a>:
<a name="l00352"></a>00352                     num_sim += f-&gt;count;
<a name="l00353"></a>00353                     <span class="keywordflow">if</span>(f-&gt;is_a_corner)
<a name="l00354"></a>00354                         cor_sim += f-&gt;count;
<a name="l00355"></a>00355                     <span class="keywordflow">break</span>;
<a name="l00356"></a>00356             }
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359         <span class="keywordtype">double</span> delta_e = total_entropy - (<a class="code" href="learn__fast__tree_8cc.html#9f5a3512e4c78a92da4ba7aaaaaf095f" title="Compute the entropy of a set with binary annotations.">entropy</a>(num_bri, cor_bri) + <a class="code" href="learn__fast__tree_8cc.html#9f5a3512e4c78a92da4ba7aaaaaf095f" title="Compute the entropy of a set with binary annotations.">entropy</a>(num_dar, cor_dar) + <a class="code" href="learn__fast__tree_8cc.html#9f5a3512e4c78a92da4ba7aaaaaf095f" title="Compute the entropy of a set with binary annotations.">entropy</a>(num_sim, cor_sim));
<a name="l00360"></a>00360 
<a name="l00361"></a>00361         delta_e *= weights[i];
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         <span class="keywordflow">if</span>(delta_e &gt; biggest_delta)
<a name="l00364"></a>00364         {       
<a name="l00365"></a>00365             biggest_delta = delta_e;
<a name="l00366"></a>00366             feature_num = i;
<a name="l00367"></a>00367         }   
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="keywordflow">if</span>(feature_num == -1)
<a name="l00371"></a>00371         <a class="code" href="group__gUtility.html#g9a3d9e758aa01b90e2067121300f17d2" title="Print an error message and the exit.">fatal</a>(3, <span class="stringliteral">"Couldn't find a split."</span>);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="keywordflow">return</span> feature_num;
<a name="l00374"></a>00374 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cdf532026168bb78545e9111afa2f008"></a><!-- doxytag: member="learn_fast_tree.cc::build_tree" ref="cdf532026168bb78545e9111afa2f008" args="(vector&lt; datapoint&lt; S &gt; &gt; &amp;corners, const vector&lt; double &gt; &amp;weights, int nfeats)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;int S&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">shared_ptr&lt;<a class="el" href="structtree.html">tree</a>&gt; build_tree           </td>
          <td>(</td>
          <td class="paramtype">vector&lt; <a class="el" href="structdatapoint.html">datapoint</a>&lt; S &gt; &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>corners</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const vector&lt; double &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nfeats</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function uses ID3 to construct a decision <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a>. 
<p>
The entropy changes are weighted by the list of weights, to allow bias towards certain features. This function assumes that the class is an exact function of the data. If there datapoints with different classes share the same feature vector, the program will crash with error code 3. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>corners</em>&nbsp;</td><td>Datapoints in this part of the subtree to classify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>weights</em>&nbsp;</td><td>Weights on the features </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nfeats</em>&nbsp;</td><td>Number of features actually used </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a> required to classify corners </dd></dl>

<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00468">468</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>

<p>References <a class="el" href="learn__fast__tree_8cc-source.html#l00116">Brighter</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00423">tree::CornerLeaf()</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00117">Darker</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00432">tree::NonCornerLeaf()</a>, and <a class="el" href="learn__fast__tree_8cc-source.html#l00118">Similar</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00469"></a>00469 {
<a name="l00470"></a>00470     <span class="comment">//Find the split</span>
<a name="l00471"></a>00471     <span class="keywordtype">int</span> f = find_best_split&lt;S&gt;(corners, weights, nfeats);
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="comment">//Split corners in to the three chunks, based on the result of find_best_split.</span>
<a name="l00474"></a>00474     <span class="comment">//Also, count how many of each class ends up in each of the three bins.</span>
<a name="l00475"></a>00475     <span class="comment">//It may apper to be inefficient to use a vector here instead of a list, in terms</span>
<a name="l00476"></a>00476     <span class="comment">//of memory, but the per-element storage overhead of the list is such that it uses</span>
<a name="l00477"></a>00477     <span class="comment">//considerably more memory and is much slower.</span>
<a name="l00478"></a>00478     vector&lt;datapoint&lt;S&gt; &gt; brighter, darker, similar;
<a name="l00479"></a>00479     uint64_t num_bri=0, cor_bri=0, num_dar=0, cor_dar=0, num_sim=0, cor_sim=0;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i &lt; corners.size(); i++)
<a name="l00482"></a>00482     {
<a name="l00483"></a>00483         <span class="keywordflow">switch</span>(corners[i].get_trit(f))
<a name="l00484"></a>00484         {
<a name="l00485"></a>00485             <span class="keywordflow">case</span> <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd921c8fbda165a3c2613fe9e6d75102d0">Brighter</a>:
<a name="l00486"></a>00486                 brighter.push_back(corners[i]);
<a name="l00487"></a>00487                 num_bri += corners[i].count;
<a name="l00488"></a>00488                 <span class="keywordflow">if</span>(corners[i].is_a_corner)
<a name="l00489"></a>00489                     cor_bri += corners[i].count;
<a name="l00490"></a>00490                 <span class="keywordflow">break</span>;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492             <span class="keywordflow">case</span> <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcd419a3322847cb783c0050a64a1df8743">Darker</a>:
<a name="l00493"></a>00493                 darker.push_back(corners[i]);
<a name="l00494"></a>00494                 num_dar += corners[i].count;
<a name="l00495"></a>00495                 <span class="keywordflow">if</span>(corners[i].is_a_corner)
<a name="l00496"></a>00496                     cor_dar += corners[i].count;
<a name="l00497"></a>00497                 <span class="keywordflow">break</span>;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499             <span class="keywordflow">case</span> <a class="code" href="learn__fast__tree_8cc.html#5475d259eeee26da1b2bcffcc581ebcdbf5e6bccdc838bc194a062b340d0d1fc">Similar</a>:
<a name="l00500"></a>00500                 similar.push_back(corners[i]);
<a name="l00501"></a>00501                 num_sim += corners[i].count;
<a name="l00502"></a>00502                 <span class="keywordflow">if</span>(corners[i].is_a_corner)
<a name="l00503"></a>00503                     cor_sim += corners[i].count;
<a name="l00504"></a>00504                 <span class="keywordflow">break</span>;
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     
<a name="l00508"></a>00508     <span class="comment">//Deallocate the memory now it's no longer needed.</span>
<a name="l00509"></a>00509     corners.clear();
<a name="l00510"></a>00510     
<a name="l00511"></a>00511     <span class="comment">//This is not the same as corners.size(), since the corners (datapoints)</span>
<a name="l00512"></a>00512     <span class="comment">//have a count assosciated with them.</span>
<a name="l00513"></a>00513     uint64_t num_tests =  num_bri + num_dar + num_sim;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     <span class="comment">//Build the subtrees</span>
<a name="l00517"></a>00517     shared_ptr&lt;tree&gt; b_tree, d_tree, s_tree;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     
<a name="l00520"></a>00520     <span class="comment">//If the sublist contains a single class, then instantiate a leaf,</span>
<a name="l00521"></a>00521     <span class="comment">//otherwise recursively build the tree.</span>
<a name="l00522"></a>00522     <span class="keywordflow">if</span>(cor_bri == 0)
<a name="l00523"></a>00523         b_tree = <a class="code" href="structtree.html#d2580fd524ddba00a5579fa2062cb4e8" title="Creat a leaf node which is a non-corner This special constructor function makes it...">tree::NonCornerLeaf</a>(num_bri);
<a name="l00524"></a>00524     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cor_bri == num_bri)
<a name="l00525"></a>00525         b_tree = <a class="code" href="structtree.html#74c9eeb0ffb179a31cb5b9bff030210a" title="Create a leaf node which is a corner This special constructor function makes it impossible...">tree::CornerLeaf</a>(num_bri);
<a name="l00526"></a>00526     <span class="keywordflow">else</span>
<a name="l00527"></a>00527         b_tree = build_tree&lt;S&gt;(brighter, weights, nfeats);
<a name="l00528"></a>00528     
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="keywordflow">if</span>(cor_dar == 0)
<a name="l00531"></a>00531         d_tree = <a class="code" href="structtree.html#d2580fd524ddba00a5579fa2062cb4e8" title="Creat a leaf node which is a non-corner This special constructor function makes it...">tree::NonCornerLeaf</a>(num_dar);
<a name="l00532"></a>00532     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cor_dar == num_dar)
<a name="l00533"></a>00533         d_tree = <a class="code" href="structtree.html#74c9eeb0ffb179a31cb5b9bff030210a" title="Create a leaf node which is a corner This special constructor function makes it impossible...">tree::CornerLeaf</a>(num_dar);
<a name="l00534"></a>00534     <span class="keywordflow">else</span>
<a name="l00535"></a>00535         d_tree = build_tree&lt;S&gt;(darker, weights, nfeats);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span>(cor_sim == 0)
<a name="l00539"></a>00539         s_tree = <a class="code" href="structtree.html#d2580fd524ddba00a5579fa2062cb4e8" title="Creat a leaf node which is a non-corner This special constructor function makes it...">tree::NonCornerLeaf</a>(num_sim);
<a name="l00540"></a>00540     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cor_sim == num_sim)
<a name="l00541"></a>00541         s_tree = <a class="code" href="structtree.html#74c9eeb0ffb179a31cb5b9bff030210a" title="Create a leaf node which is a corner This special constructor function makes it impossible...">tree::CornerLeaf</a>(num_sim);
<a name="l00542"></a>00542     <span class="keywordflow">else</span>
<a name="l00543"></a>00543         s_tree = build_tree&lt;S&gt;(similar, weights, nfeats);
<a name="l00544"></a>00544     
<a name="l00545"></a>00545     <span class="keywordflow">return</span> shared_ptr&lt;tree&gt;(<span class="keyword">new</span> <a class="code" href="structtree.html" title="This class represents a decision tree.">tree</a>(b_tree, d_tree, s_tree, f, num_tests));
<a name="l00546"></a>00546 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="787dd76ed463ffe6364edd7699ccbd5a"></a><!-- doxytag: member="learn_fast_tree.cc::print_tree" ref="787dd76ed463ffe6364edd7699ccbd5a" args="(const tree *node, ostream &amp;o, const string &amp;i=&quot;&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_tree           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structtree.html">tree</a> *&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ostream &amp;&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&nbsp;</td>
          <td class="paramname"> <em>i</em> = <code>&quot;&quot;</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function traverses the <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a> and produces a textual representation of it. 
<p>
Additionally, if any of the subtrees are the same, then a single subtree is produced and the test is removed.<p>
A subtree has the following format: <div class="fragment"><pre class="fragment">
    subtree= lead | node;
    
    leaf = "corner" | "background" ;

    node = node2 | node3;

    node3 = "if_brighter" feature_number n1 n2 n3
                subtree
            "elsf_darker" feature_number
                subtree
            "else"
                subtree
            "end";

     node2= if_statement feature_number n1 n2
                subtree
            "else"
                subtree
            "end";

    if_statement = "if_brighter" | "if_darker" | "if_either";
    feature_number ==integer;
    n1 = integer;
    n2 = integer;
    n3 = integer;
</pre></div><p>
<em>feature_number</em> refers to the index of the feature that the test is performed on.<p>
In <em>node3</em>, a 3 way test is performed. <em>n1</em>, <em>n2</em> and <em>n3</em> refer to the number of training examples landing in the <em>if</em> block, the <em>elfs</em> block and the <em>else</em> block respectivly.<p>
In a <em>node2</em> node, one of the tests has been removed. <em>n1</em> and <em>n2refer</em> to the number of training examples landing in the <em>if</em> block and the <em>else</em> block respectivly.<p>
Although not mentioned in the grammar, the indenting is kept very strict.<p>
This representation has been designed to be parsed very easily with simple regular expressions, hence the use if "elsf" as opposed to "elif" or "elseif".<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>(sub)<a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a> to serialize </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>o</em>&nbsp;</td><td>Stream to serialize to. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>i</em>&nbsp;</td><td>Indent to print before each line of the serialized <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a>. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00601">601</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>

<p>References <a class="el" href="learn__fast__tree_8cc-source.html#l00399">tree::brighter</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00394">tree::Corner</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00400">tree::darker</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00403">tree::feature_to_test</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00402">tree::is_a_corner</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00395">tree::NonCorner</a>, <a class="el" href="learn__fast__tree_8cc-source.html#l00404">tree::num_datapoints</a>, and <a class="el" href="learn__fast__tree_8cc-source.html#l00401">tree::similar</a>.</p>

<p>Referenced by <a class="el" href="learn__fast__tree_8cc-source.html#l00692">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {
<a name="l00603"></a>00603     <span class="keywordflow">if</span>(node-&gt;<a class="code" href="structtree.html#2b87abfe9d4b7855a69e7f6cd741ae0d" title="Class of this node (if its a leaf).">is_a_corner</a> == <a class="code" href="structtree.html#b5c56b6f06ca97e05a0279bc160b5ac067ff8625432546cee52c13791b5aa44a">tree::Corner</a>)
<a name="l00604"></a>00604         o &lt;&lt; i &lt;&lt; <span class="stringliteral">"corner"</span> &lt;&lt; endl;
<a name="l00605"></a>00605     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(node-&gt;<a class="code" href="structtree.html#2b87abfe9d4b7855a69e7f6cd741ae0d" title="Class of this node (if its a leaf).">is_a_corner</a> == <a class="code" href="structtree.html#b5c56b6f06ca97e05a0279bc160b5ac00572318008570e7add7191eabe4309f3">tree::NonCorner</a>)
<a name="l00606"></a>00606         o &lt;&lt; i &lt;&lt; <span class="stringliteral">"background"</span> &lt;&lt; endl;
<a name="l00607"></a>00607     <span class="keywordflow">else</span>
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609         <span class="keywordtype">string</span> b = node-&gt;<a class="code" href="structtree.html#92cf3beb390f661b4c5486592013b140" title="Subtrees.">brighter</a>-&gt;stringify();
<a name="l00610"></a>00610         <span class="keywordtype">string</span> d = node-&gt;<a class="code" href="structtree.html#1f6f3125c2fab213da95dfdf530c13dc" title="Subtrees.">darker</a>-&gt;stringify();
<a name="l00611"></a>00611         <span class="keywordtype">string</span> s = node-&gt;<a class="code" href="structtree.html#19c5e5fecea332fce87f03fa7e5929f5" title="Subtrees.">similar</a>-&gt;stringify();
<a name="l00612"></a>00612 
<a name="l00613"></a>00613         <span class="keyword">const</span> <a class="code" href="structtree.html" title="This class represents a decision tree.">tree</a> * bt = node-&gt;<a class="code" href="structtree.html#92cf3beb390f661b4c5486592013b140" title="Subtrees.">brighter</a>.get();
<a name="l00614"></a>00614         <span class="keyword">const</span> <a class="code" href="structtree.html" title="This class represents a decision tree.">tree</a> * dt = node-&gt;<a class="code" href="structtree.html#1f6f3125c2fab213da95dfdf530c13dc" title="Subtrees.">darker</a>.get();
<a name="l00615"></a>00615         <span class="keyword">const</span> <a class="code" href="structtree.html" title="This class represents a decision tree.">tree</a> * st = node-&gt;<a class="code" href="structtree.html#19c5e5fecea332fce87f03fa7e5929f5" title="Subtrees.">similar</a>.get();
<a name="l00616"></a>00616         <span class="keywordtype">string</span> ii = i + <span class="stringliteral">" "</span>;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618         <span class="keywordtype">int</span> f = node-&gt;<a class="code" href="structtree.html#1a36930bec5910f253a8961838481713" title="Feature (ie pixel) to test if this is a non-leaf.">feature_to_test</a>;
<a name="l00619"></a>00619     
<a name="l00620"></a>00620         <span class="keywordflow">if</span>(b == d &amp;&amp; d == s) <span class="comment">//All the same</span>
<a name="l00621"></a>00621         {
<a name="l00622"></a>00622             <span class="comment">//o &lt;&lt; i &lt;&lt; "if " &lt;&lt; f &lt;&lt; " is whatever\n";</span>
<a name="l00623"></a>00623             <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(st, o, i);
<a name="l00624"></a>00624         }
<a name="l00625"></a>00625         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(d == s)  <span class="comment">//Bright is different</span>
<a name="l00626"></a>00626         {
<a name="l00627"></a>00627             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"if_brighter "</span> &lt;&lt; f &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; bt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; dt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a>+st-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> &lt;&lt; endl;
<a name="l00628"></a>00628                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(bt, o, ii);
<a name="l00629"></a>00629             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"else"</span> &lt;&lt; endl;
<a name="l00630"></a>00630                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(st, o, ii);
<a name="l00631"></a>00631             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"end"</span> &lt;&lt; endl;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633         }
<a name="l00634"></a>00634         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(b == s) <span class="comment">//Dark is different</span>
<a name="l00635"></a>00635         {   
<a name="l00636"></a>00636             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"if_darker "</span> &lt;&lt; f &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; dt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; bt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> + st-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> &lt;&lt; endl;
<a name="l00637"></a>00637                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(dt, o, ii);
<a name="l00638"></a>00638             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"else"</span> &lt;&lt; endl;
<a name="l00639"></a>00639                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(st, o, ii);
<a name="l00640"></a>00640             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"end"</span> &lt;&lt; endl;
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(b == d) <span class="comment">//Similar is different</span>
<a name="l00643"></a>00643         {
<a name="l00644"></a>00644             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"if_either "</span> &lt;&lt; f &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt;  bt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> + dt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a>  &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; st-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> &lt;&lt; endl;
<a name="l00645"></a>00645                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(bt, o, ii);
<a name="l00646"></a>00646             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"else"</span> &lt;&lt; endl;
<a name="l00647"></a>00647                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(st, o, ii);
<a name="l00648"></a>00648             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"end"</span> &lt;&lt; endl;
<a name="l00649"></a>00649         }
<a name="l00650"></a>00650         <span class="keywordflow">else</span> <span class="comment">//All different</span>
<a name="l00651"></a>00651         {
<a name="l00652"></a>00652             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"if_brighter "</span> &lt;&lt; f &lt;&lt; <span class="stringliteral">" "</span>  &lt;&lt;  bt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; dt-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a>  &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; st-&gt;<a class="code" href="structtree.html#ce82fc013bf129de16ea47ccaddc64d1" title="Number of datapoints passing through this node.">num_datapoints</a> &lt;&lt; endl;
<a name="l00653"></a>00653                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(bt, o, ii);
<a name="l00654"></a>00654             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"elsf_darker "</span> &lt;&lt; f &lt;&lt; endl;
<a name="l00655"></a>00655                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(dt, o, ii);
<a name="l00656"></a>00656             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"else"</span> &lt;&lt; endl;
<a name="l00657"></a>00657                 <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(st, o, ii);
<a name="l00658"></a>00658             o &lt;&lt; i &lt;&lt; <span class="stringliteral">"end"</span> &lt;&lt; endl;
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7c577f5c2749b97093f09f57637f48fb"></a><!-- doxytag: member="learn_fast_tree.cc::load_and_build_tree" ref="7c577f5c2749b97093f09f57637f48fb" args="(unsigned int num_features, const vector&lt; double &gt; &amp;weights)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;int S&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">V_tuple&lt;shared_ptr&lt;<a class="el" href="structtree.html">tree</a>&gt;, uint64_t&gt;::type load_and_build_tree           </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>num_features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const vector&lt; double &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>weights</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function loads data and builds a <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a>. 
<p>
It is templated because <a class="el" href="structdatapoint.html" title="This structure represents a datapoint.">datapoint</a> is templated, for reasons of memory efficiency. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>num_features</em>&nbsp;</td><td>Number of features used </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>weights</em>&nbsp;</td><td>Weights on each feature. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The learned <a class="el" href="structtree.html" title="This class represents a decision tree.">tree</a>, and number of datapoints. </dd></dl>

<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00668">668</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00669"></a>00669 {
<a name="l00670"></a>00670     assert(weights.size() == num_features);
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     shared_ptr&lt;vector&lt;datapoint&lt;S&gt; &gt; &gt; l;
<a name="l00673"></a>00673     uint64_t num_datapoints;
<a name="l00674"></a>00674     
<a name="l00675"></a>00675     <span class="comment">//Load the data</span>
<a name="l00676"></a>00676     make_rtuple(l, num_datapoints) = load_features&lt;S&gt;(num_features);
<a name="l00677"></a>00677     
<a name="l00678"></a>00678     cerr &lt;&lt; <span class="stringliteral">"Loaded.\n"</span>;
<a name="l00679"></a>00679     
<a name="l00680"></a>00680     <span class="comment">//Build the tree</span>
<a name="l00681"></a>00681     shared_ptr&lt;tree&gt; <a class="code" href="structtree.html" title="This class represents a decision tree.">tree</a>;
<a name="l00682"></a>00682     tree  = build_tree&lt;S&gt;(*l, weights, num_features);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="keywordflow">return</span> make_vtuple(tree, num_datapoints);
<a name="l00685"></a>00685 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="learn_fast_tree.cc::main" ref="3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The main program. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>argc</em>&nbsp;</td><td>Number of commandline arguments </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>argv</em>&nbsp;</td><td>Commandline arguments </td></tr>
  </table>
</dl>

<p>
Each feature takes up 2 bits. Since GCC doesn't pack any finer then 32 bits for hetrogenous structs, there is no point in having granularity finer than 16 features. 
<p>Definition at line <a class="el" href="learn__fast__tree_8cc-source.html#l00692">692</a> of file <a class="el" href="learn__fast__tree_8cc-source.html">learn_fast_tree.cc</a>.</p>

<p>References <a class="el" href="learn__fast__tree_8cc-source.html#l00125">fatal</a>, <a class="el" href="offsets_8cc-source.html#l00049">offsets</a>, and <a class="el" href="learn__fast__tree_8cc-source.html#l00601">print_tree()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00693"></a>00693 {
<a name="l00694"></a>00694     <span class="comment">//Set up default arguments</span>
<a name="l00695"></a>00695     GUI.parseArguments(argc, argv);
<a name="l00696"></a>00696 
<a name="l00697"></a>00697     cin.sync_with_stdio(<span class="keyword">false</span>);
<a name="l00698"></a>00698     cout.sync_with_stdio(<span class="keyword">false</span>);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700     <span class="comment"></span>
<a name="l00701"></a>00701 <span class="comment">    ///////////////////</span>
<a name="l00702"></a>00702 <span class="comment"></span>    <span class="comment">//read file</span>
<a name="l00703"></a>00703     
<a name="l00704"></a>00704     <span class="comment">//Read number of features</span>
<a name="l00705"></a>00705     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_features;
<a name="l00706"></a>00706     cin &gt;&gt; num_features;
<a name="l00707"></a>00707     <span class="keywordflow">if</span>(!cin.good() || cin.eof())
<a name="l00708"></a>00708         <a class="code" href="group__gUtility.html#g9a3d9e758aa01b90e2067121300f17d2" title="Print an error message and the exit.">fatal</a>(6, <span class="stringliteral">"Error reading number of features."</span>);
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <span class="comment">//Read offset list</span>
<a name="l00711"></a>00711     vector&lt;ImageRef&gt; <a class="code" href="group__gTree.html#gba2611edc3d025abd67eb4d57c5e9672" title="Actual x,y offset of the offset numbers in the different available orientations.">offsets</a>(num_features);
<a name="l00712"></a>00712     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; num_features; i++)
<a name="l00713"></a>00713         cin &gt;&gt; <a class="code" href="group__gTree.html#gba2611edc3d025abd67eb4d57c5e9672" title="Actual x,y offset of the offset numbers in the different available orientations.">offsets</a>[i];
<a name="l00714"></a>00714     <span class="keywordflow">if</span>(!cin.good() || cin.eof())
<a name="l00715"></a>00715         <a class="code" href="group__gUtility.html#g9a3d9e758aa01b90e2067121300f17d2" title="Print an error message and the exit.">fatal</a>(7, <span class="stringliteral">"Error reading offset list."</span>);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="comment">//Read weights for the various offsets</span>
<a name="l00718"></a>00718     vector&lt;double&gt; weights(<a class="code" href="group__gTree.html#gba2611edc3d025abd67eb4d57c5e9672" title="Actual x,y offset of the offset numbers in the different available orientations.">offsets</a>.size());
<a name="l00719"></a>00719     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; weights.size(); i++)
<a name="l00720"></a>00720         weights[i] = GV3::get&lt;double&gt;(sPrintf(<span class="stringliteral">"weights.%i"</span>, i), 1, 1);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     shared_ptr&lt;tree&gt; <a class="code" href="structtree.html" title="This class represents a decision tree.">tree</a>;
<a name="l00724"></a>00724     uint64_t num_datapoints;
<a name="l00725"></a>00725 <span class="comment"></span>
<a name="l00726"></a>00726 <span class="comment">    ///Each feature takes up 2 bits. Since GCC doesn't pack any finer</span>
<a name="l00727"></a>00727 <span class="comment">    ///then 32 bits for hetrogenous structs, there is no point in having</span>
<a name="l00728"></a>00728 <span class="comment">    ///granularity finer than 16 features.</span>
<a name="l00729"></a>00729 <span class="comment"></span>    <span class="keywordflow">if</span>(num_features &lt;= 16)
<a name="l00730"></a>00730         make_rtuple(tree, num_datapoints) = load_and_build_tree&lt;16&gt;(num_features, weights);
<a name="l00731"></a>00731     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(num_features &lt;= 32)
<a name="l00732"></a>00732         make_rtuple(tree, num_datapoints) = load_and_build_tree&lt;32&gt;(num_features, weights);
<a name="l00733"></a>00733     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(num_features &lt;= 48)
<a name="l00734"></a>00734         make_rtuple(tree, num_datapoints) = load_and_build_tree&lt;48&gt;(num_features, weights);
<a name="l00735"></a>00735     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(num_features &lt;= 64)
<a name="l00736"></a>00736         make_rtuple(tree, num_datapoints) = load_and_build_tree&lt;64&gt;(num_features, weights);
<a name="l00737"></a>00737     <span class="keywordflow">else</span>
<a name="l00738"></a>00738         <a class="code" href="group__gUtility.html#g9a3d9e758aa01b90e2067121300f17d2" title="Print an error message and the exit.">fatal</a>(8, <span class="stringliteral">"Too many feratures (%i). To learn from this, see %s, line %i."</span>, num_features, __FILE__, __LINE__);
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     
<a name="l00741"></a>00741     cout &lt;&lt; num_features &lt;&lt; endl;
<a name="l00742"></a>00742     copy(<a class="code" href="group__gTree.html#gba2611edc3d025abd67eb4d57c5e9672" title="Actual x,y offset of the offset numbers in the different available orientations.">offsets</a>.begin(), <a class="code" href="group__gTree.html#gba2611edc3d025abd67eb4d57c5e9672" title="Actual x,y offset of the offset numbers in the different available orientations.">offsets</a>.end(), ostream_iterator&lt;ImageRef&gt;(cout, <span class="stringliteral">" "</span>));
<a name="l00743"></a>00743     cout &lt;&lt; endl;
<a name="l00744"></a>00744     <a class="code" href="learn__fast__tree_8cc.html#787dd76ed463ffe6364edd7699ccbd5a" title="This function traverses the tree and produces a textual representation of it.">print_tree</a>(tree.get(), cout);
<a name="l00745"></a>00745 }
</pre></div>
<p>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 5 10:25:01 2008 for FAST-ER by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
